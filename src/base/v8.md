---
lang: zh-CN
sidebarDepth: 2
meta:
  - name: description
    content: 个人总结的vuepress学习技术文档-语法
  - name: keywords
    content: vuepress,最新技术文档,vuepress语法,markdown语法
---

# v8 引擎机制

## 1.v8 如何执行一段 js 代码

- 1.预解析：检测语法错误但不生成 AST
- 2.生成 AST:经过词法/语法分析，生成抽象语法树
- 3.生成字节码：基线编译器将 AST 转换成字节码
- 4.生成机器码：优化编译器将字节码转换成优化过的机器码，此外在逐行执行字节码的过程中，如果一段代码经常被执行，那么 V8 会将这段代码直接转换成机器码保持起来，下一次执行就不必经过字节码，优化了执行速度

## 2.介绍一下引用计数和标记清除

- 1.引用计数：给一个变量赋值引用类型，则该对象的引用次数+1,如果这个变量变成了其他值，那么该对象的引用次数-1，垃圾回收器会回收引用次数为 0 的对象，但是当对象循环引用时，会导致引用次数永远无法归零，造成内存无法释放。
- 2.标记清除：垃圾收集器先给内存中所有对象加上标记，然后从根节点开始遍历，去掉被引用的对象和运行环境中对象的标记，剩下的被标记的对象就是无法访问的等待回收的对象。

## 3.v8 如何进行垃圾回收

js 引擎中对变量的存储主要有两种位置，栈内存和堆内存，栈内存存储基本类型数据及引用类型数据的内存地址，对内存存储引用类型的数据。

> 栈内存回收
> 栈内存调用栈上下文切换后就被回收
> 堆内存的回收
> V8 的堆内存分为新生代和老生代内存，新生代内存是临时分配的内存，存在时间短，老生代内存存在时间长

- 新生代内存回收机制
  - 新生代内存容量小，64 位系统下仅有 32M，新生代内存分为 From、To 两部分，进行垃圾回收时，先扫描 From,将非存活对象回收，将存活对象顺序复制到 To 中，之后调换 From/to，等待下一次回收
- 老生代内存回收机制
- 晋升：如果新生代的变量经过多次回收依然存在，那么就会被放入老生代内存中
- 标记清除：老生代内存会先遍历所有对象并打上标记，然后对正在使用或强引用的对象取消标记，回收被标记的对象
- 整理内存碎片；把对象挪到内存的一端

## 4. JS 相较于 C++等语言为什么慢，V8 做了哪些优化
